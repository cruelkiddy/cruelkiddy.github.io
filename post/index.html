<!DOCTYPE html>
<html lang="en-us">
  <head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="x-ua-compatible" content="ie=edge"><title>Dongxu&#39;s Blog</title>
    
<link rel="icon" type="image/png" href="/images/favicon.png" />


<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans" rel="stylesheet"><link rel="stylesheet" type="text/css" href="/css/style.min.f4d8930701ac14f288dcb4efc7475f6ccd49ced8b270c4a433d0cd58b6eb8a93.css" integrity="sha256-9NiTBwGsFPKI3LTvx0dfbM1JztiycMSkM9DNWLbripM=">
<link rel="stylesheet" type="text/css" href="/css/monokai-sublime.9.15.8.min.min.3a5d282f03108101d715e80fd4c07b55502ec4673fc063f2b6e415d4def5b354.css" integrity="sha256-Ol0oLwMQgQHXFegP1MB7VVAuxGc/wGPytuQV1N71s1Q=">
<link rel="stylesheet" type="text/css" href="/css/icons.min.56faae60f16170cbfab5c036036aafb37d367aa4d4f4483b335bd98b891fa00b.css" integrity="sha256-VvquYPFhcMv6tcA2A2qvs302eqTU9Eg7M1vZi4kfoAs=">
<link rel="stylesheet" type="text/css" href="/css/mycss.min.8dbf4fbe59ea8af9be1d67d084bc8698e032e05602f08b8fe84ca0d2d46c298d.css" integrity="sha256-jb9Pvlnqivm&#43;HWfQhLyGmOAy4FYC8IuP6Eyg0tRsKY0=">

  </head>
  <body>
    
    <div id="preloader">
      <div id="status"></div>
    </div><nav class="navbar is-fresh is-transparent no-shadow" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">

      
      
      
      <a class="navbar-item">
        <div class="menu-icon-wrapper left-menu-icon-wrapper" style="visibility: visible;">
          <svg width="1000px" height="1000px">
            <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
            <path class="path2" d="M 300 500 L 700 500"></path>
            <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
          </svg>
          <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
        </div>
        <div class="navbar-item left-menu-icon-wrapper">Tags</div>
      </a>

      <div class="navbar-item is-expanded"></div>
      <a class="navbar-item is-hidden-desktop">  
        <div data-target="navbar-menu" class="navbar-item right-menu-icon-wrapper is-hidden-desktop">Menu</div>
        <div data-target="navbar-menu" class="menu-icon-wrapper right-menu-icon-wrapper" style="visibility: visible;">
          <svg width="1000px" height="1000px">
            <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
            <path class="path2" d="M 300 500 L 700 500"></path>
            <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
          </svg>
          <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
        </div>
      </a>
    </div>

    

    <div id="navbar-menu" class="navbar-menu is-static">
      
      <div class="navbar-end">
        <a href="/about" class="navbar-item is-secondary">
          About Me
        </a><a href="https://cruelkiddy.github.io/post/" class="navbar-item is-secondary">Posts</a></div>
    </div>




  </div>
</nav><nav id="navbar-clone" class="navbar is-fresh is-transparent" role="navigation" aria-label="main navigation">
  <div class="container">
      <div class="navbar-brand">
  
        
        
        
        <a class="navbar-item">
          <div class="menu-icon-wrapper left-menu-icon-wrapper" style="visibility: visible;">
            <svg width="1000px" height="1000px">
              <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
              <path class="path2" d="M 300 500 L 700 500"></path>
              <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
            </svg>
            <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
          </div>
          <div class="navbar-item left-menu-icon-wrapper">Tags</div>
        </a>
  
        <div class="navbar-item is-expanded"></div>
        <a class="navbar-item is-hidden-desktop">  
          <div data-target="cloned-navbar-menu" class="navbar-item right-menu-icon-wrapper is-hidden-desktop">Menu</div>
          <div data-target="cloned-navbar-menu" class="menu-icon-wrapper right-menu-icon-wrapper" style="visibility: visible;">
            <svg width="1000px" height="1000px">
              <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
              <path class="path2" d="M 300 500 L 700 500"></path>
              <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
            </svg>
            <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
          </div>
        </a>
      </div>
  
      
  
      <div id="cloned-navbar-menu" class="navbar-menu is-static">
        <div class="navbar-end">
          <a href="/about" class="navbar-item is-secondary">
            About Me
          </a><a href="https://cruelkiddy.github.io/post/" class="navbar-item is-secondary">Posts</a></div>
      </div>
  
  
  
  
    </div>
  </nav>
<section class="section is-medium">
        <div class="container">
          <div class="columns">
            <div class="column is-centered-tablet-portrait">
              <h1 class="title section-title">Posts</h1>
              <h5 class="subtitle is-5 is-muted"></h5>
              <div class="divider"></div>        
              <div class="section is-medium">
                <div class="container"><div class="columns"></div>
                          <div class="columns"><div class="column is-4">
    <div class="box">
      <figure class="image is-3by2">
        <a href="/post/1.4/"><img src="/images/default_summary_huf9e8951c3521e8dfaa05ae09a282bc27_276881_600x0_resize_q75_box.jpg" alt=""></a>
      </figure>
      <h3 class="title is-5 summary-title">
        1.4
      </h3>
      <p class="summary-summary">读§1.4 （坚持写读书笔记越来越困难了，空闲时间不再那么多了，螳臂当车？
这一节讲条件概率
动机 在实际问题中，除了要知道事件\(A\) 的概率\(P(A)\) 外，有时还需要知道在事件\(B\) 已出现的条件下，事件\(A\) 出现的条件概率\(P(A|B)\) 是不同的。
定义 依然是受频率的启发，在事件 \(B\) 发生的情况下，事件\(A\) 发生的频率\(F_n(A|B)= \frac{F_n(AB)}{F_n(B)}\) 。我们在定义条件概率时用相同的形式\(P(A|B)=\frac{P(AB)}{P(B)}\) ，当然这个定义是在之前建立起的概率空间的体系之下讨论的。
性质 上面定义出的条件概率也是概率，因此之前所有概率满足的性质和结果条件概率都适用
有关条件概率的三定理 （公式就不写出来了，懒😄
概率的乘法定理 这个定理说：多个事件同时发生的概率等于给这些事件排好序，一件一件发生的概率
这很符合常识，给比较混乱的多个事件排序也很符合人的认知习惯
全概率公式 全概率公式说：我先把\(\Omega\) 划分成有穷或可列个不相容的事件\(H_n\)（大意是这样，可列个的话是极限意义的划分这些事件的并概率为1），接着我描述一个事件\(A\) 的概率时引入事件\(H_n\)， \(A\)发生的概率等于在每个\(H_n\) 的基础上发生的概率。
这有点分类的感觉，也很符合人的认知
贝叶斯公式 （这个公式似乎是在全概率公式的基础上得到的。
这个定理也引入了划分\(\Omega\) 的事件列\(H_n\) ，他想研究一个结果\(A\)发生时，同时发生的\(H_n\)是谁的问题。
证明就用了条件概率的定义和全概率公式
这个东西好像用在机器学习学习的分类里面，\(H_n\) 是一列不同的类别，经过一系列操作\(A\) 发生了，到底是哪一类呢？看看公式右边，如果想要计算，需要知道各个类发生的概率、各个类发生时\(A\) 发生的概率
可能以后会有更深的理解吧
（To be continued......
</p> 
      <div class="action has-text-right">
        <a href="/post/1.4/" class="button is-primary">
                Read More
            </a>
      </div>
    </div>
  </div><div class="column is-4">
    <div class="box">
      <figure class="image is-3by2">
        <a href="/post/1.2/"><img src="/images/default_summary_huf9e8951c3521e8dfaa05ae09a282bc27_276881_600x0_resize_q75_box.jpg" alt=""></a>
      </figure>
      <h3 class="title is-5 summary-title">
        1.2 &amp; 1.3
      </h3>
      <p class="summary-summary">读§1.2 这一节介绍了古典型概率的一些模型和计算技巧，涉及一些排列组合的知识。由于我读此书的目的不是解题，这一节极略读。
首先推广了随机试验，提出n次复合随机试验的概念。需要注意的是，这n次实验是有位置次序的。
另外，需要注意的是：古典型概率的定义方式，每个基本事件概率的大小相等。
读§1.3 这一节介绍了概率的公理化定义✌️
事件空间
\(\cal{F}\)是\(\Omega\)上的\(\sigma\)-代数
这样定义保证了如何折腾（做运算）事件，事件仍然是事件。
事件空间并没有穷尽所有的可能，一方面我们可能并不关心某些事件。
另一方面，有些事件我们研究起来十分困难。
概率测度
概率测度是定义在\(\cal{F}\)上的满足三条性质（当然，这三条性质能推出更多的性质）的实值集函数
这样定义或许受到了频率性质的启发。
可以看到，很大范围的“概率”能纳入这个体系中：古典型概率、几何形概率
概率的性质
1.基本性质（略）
2.连续性：
容易发现，连续性是象在原象的某种极限运动中的某种极限行为
概率在事件单调地极限运动时就具有连续性
（To be continued
</p> 
      <div class="action has-text-right">
        <a href="/post/1.2/" class="button is-primary">
                Read More
            </a>
      </div>
    </div>
  </div><div class="column is-4">
    <div class="box">
      <figure class="image is-3by2">
        <a href="/post/1.1/"><img src="/images/default_summary_huf9e8951c3521e8dfaa05ae09a282bc27_276881_600x0_resize_q75_box.jpg" alt=""></a>
      </figure>
      <h3 class="title is-5 summary-title">
        1.1
      </h3>
      <p class="summary-summary"> 我的前言 我认为我有充分的理由学习概率论。上次的compulsory期间，我借了一本精装的概率论书籍概率论基础及其应用/王梓坤文集 据说质量很高，因此这本书自然而然成了我“重修”概率论的参考书。我希望自己能坚持读完，并在此记一些笔记，一能督促自己的学习，二能总结出一些“自己想要的东西”。闲话少叙，这就开始了。
读前言 我不经常看书的前言（也不常看教材之外的书😄），但这本书包装如此精美，且是一本“文集”，我决定认真读书上的每一个字。前言讲了王梓坤先生读书科研的经历，和做出的种种贡献。王先生的投入之全心全意令人难以忽略。我能看到这样一个极其“单调”但是极其“伟大”的人。这可能就是一种balance吧，要想问心无愧地做出一些伟大的成果，就要牺牲一些东西 。当然先生也做了一些并不“单调”的工作：做校长、提议教师节、受任国家研究地震的预测……另外让我印象深刻的是他的“单调”是从一而终的（又开始成语误用了），即使在&amp;rdquo;文革&amp;rdquo;期间，也潜心关注数学的发展动态。能感受到王先生对于数学的坚定是超越政治、经济等等外界环境的。就像他自勉用的格言所说：
 &amp;ldquo;我尊重这样的人，他心怀博大，待人宽厚；朝观剑舞，夕临秋水，观剑以励志奋进，读庄以淡化世纷；公而忘私，勤于职守；力求无负与前人，无罪于今人，无愧于后人。&amp;rdquo;
 读§1.1 这一节联系实际介绍了一些基础概念
（随机）事件： （我的常识是）之所以随机是因为给出的条件不全，即若给出充足的条件，所有的事件都是可以给出或必然或不可能的判断的。我学概率的期待之一，其实是希望概率论能告诉我这种常识的简单和局限。
事件空间 这里有一个小的断言：所有的事件都是$$\Omega$$ 的子集。同时可以说，所有事件都是由基本事件的运算产生的。这个statement并不在我的常识中，我没有意识到所有可能出现的结果其实是可以预见的。
概率： 概率的实际意义是衡量一个事件发生可能性大小的数字，他在不同的模型中显然可以不同。（认识到这一点算是一个收获。）在数学的意义上，他是一种”测度“，是推广”积分“时产生的一种”工具“。
频率： 定义了频率，指出频率和概率有关。指出今后可以证明：在相当广泛的情形下，概率的极限就是概率。
（我不太懂这里的概率是不是要说明一下是怎么定义的，还是说在“相当广泛的情形下”，概率的定义是唯一的？
（读过§1.3就可以理解了，这里并不在意概率具体是如何定义的，因为所有符合概率定义的实值集函数都满足
杂谈： 这本书在定义事件时没有一上来就引入”集合“，而是在定义之后提到这和”集合“密切相关，因此引入了集合来表示事件，我认为这很自然，不像某些书那么突兀。
书中提到复杂概念甲由一个稍简单的概念乙定义，乙由更简单的丙定义，一定会遇到某个定义或概念无法再解释。这并不用慌张，这时就用不太严谨的描述罢了。
很多人讨厌数学繁多啰嗦的定义，但仔细分析这些基本的定义，常常能重新形成一些很底层的概念。
我正尝试用这种方法重塑三观。
(To be continued……)
</p> 
      <div class="action has-text-right">
        <a href="/post/1.1/" class="button is-primary">
                Read More
            </a>
      </div>
    </div>
  </div></div>
                          <div class="columns"><div class="column is-4">
    <div class="box">
      <figure class="image is-3by2">
        <a href="/post/untitled/"><img src="/images/default_summary_huf9e8951c3521e8dfaa05ae09a282bc27_276881_600x0_resize_q75_box.jpg" alt=""></a>
      </figure>
      <h3 class="title is-5 summary-title">
        Untitled
      </h3>
      <p class="summary-summary">恐怕这一篇要写成日记了。
今天参加了外研社杯英语写作和阅读竞赛的网络初赛。让人惊喜，题目出得十分有趣。写作第一篇议论文直戳我的痛点：如何看待选课人数太少导致的课程取消问题。我可能有些跑题，不知不觉将问题转换成大学是科研机构，应该更重视科研。（看起来没有什么逻辑了）不论如何，洋洋洒洒最终写了500多字。第二题有些像在Quora上答题，挺有代入感的。
阅读就更有趣了，出现了很多我没见过的观点。一篇文章提到了一种gig economy(零工经济)。公司按照项目组招人，一个项目结项大家散伙，下一个项目重新招人。如果有机会我挺想试试这种模式，很有一种神偷说“干完这票大的就退休”的感觉。😄
一篇短文提出“生理上营养的缺乏导致抑郁”的观点，我开始怀疑自己是这种情况。
一篇短文提出朋友是make出来的（可执行文件也是😄）而不是find出来的（可执行文件也是😄）。并且大家都很nice，constant contact就会成为好朋友。这条很有指导意义，混脸熟就是这意思。
记忆力有点差，想不起来别的了&amp;hellip;
晚上和妈妈出去散步聊了不少，聊到一些有趣的事：
心理咨询像是唤醒一些尘封的记忆，我们可能在过去某个时刻做出了某个决定，或者产生了某种行为。随着时间的流逝，我们可能忘记了为什么会产生这种行为，但是行为本身却保留了下来。当这种行为产生了困扰，心理咨询师会试图让你想起或者找到一个最初的原因。
我们在对很多问题归因的时候会忽视其背后的“概率”因素。很多事情不是板上钉钉的，需要引入“概率”描述的更加清楚。（概率没学好需要补，不只是数学，还能提炼一些哲学思想）
先别想那么远，影响了美好的当下。
接上条，我这就买琴。😄
交朋友没那么难。拿一部分精力放在社交上面。
想不起来了
</p> 
      <div class="action has-text-right">
        <a href="/post/untitled/" class="button is-primary">
                Read More
            </a>
      </div>
    </div>
  </div><div class="column is-4">
    <div class="box">
      <figure class="image is-3by2">
        <a href="/post/compulsory/"><img src="/images/default_summary_huf9e8951c3521e8dfaa05ae09a282bc27_276881_600x0_resize_q75_box.jpg" alt=""></a>
      </figure>
      <h3 class="title is-5 summary-title">
        直方图的强迫
      </h3>
      <p class="summary-summary">背景 今天《数字图像处理》课上讲了直方图均衡，由于种种原因，我产生了一种强迫性的行为：我要尽可能严谨地讲清楚直方图均衡的来龙去脉，在做到这点之前，我十分痛苦。下面讲的就是我强迫性的行为所带来的“收获”
我的强迫  直方图的概念  直方图
什么是直方图均衡，为何要这样做  直方图均衡是一种图像“变换”，直观的看，变换后图像的直方图变成了一个在整个定义域上常函数。维基说：
 这种方法通常用来增加许多图像的全局对比度，尤其是当图像的有用数据的对比度相当接近的时候。通过这种方法，亮度可以更好地在直方图上分布。这样就可以用于增强局部的对比度而不影响整体的对比度，直方图均衡化通过有效地扩展常用的亮度来实现这种功能。
这种方法对于背景和前景都太亮或者太暗的图像非常有用，这种方法尤其是可以带来X光图像中更好的骨骼结构显示以及曝光过度或者曝光不足照片中更好的细节。这种方法的一个主要优势是它是一个相当直观的技术并且是可逆操作，如果已知均衡化函数，那么就可以恢复原始的直方图，并且计算量也不大。这种方法的一个缺点是它对处理的数据不加选择，它可能会增加背景噪声的对比度并且降低有用信号的对比度。
 至于直方图是如何达到这种效果的，在比较清楚地了解了其背后的原理后再进行讨论。总之，我们要做的是找到一个变换 \(T(x)\) 使得变换后的\(T(image)\) 的直方图是一个常函数\(f(rank) = K\) , \(\forall\)\(rank\) \(\in\) \(RankDomain\)
如何找到这样的一个变换\(T(x)\)  根据一些图像处理的知识，变换\(T(x)\) 需要满足以下一些条件：
（i）\(T(x)\)是广义单调增加的。这保证像素之间灰度级的大小关系保持不变。
下面引入概率论的思想来求这个变换。将像素点\(i\)的灰度值视为一个随机变量\(\xi_i\)，
\[\xi_i \coprod \xi_j ， \forall i\ne j ， i, j \in Image\]
定义概率\(P(\xi = k)\) = \(\frac{n_k}{n}\)
\(n_k\) \(:=\) 灰度为\(k\)的像素点的个数
\(n:=\) 图像总像素点个数
 弃更了，google到一篇很清楚的解释，数学也比较严谨在这里
会搜索是多么重要，\(Gan\)。
(提高hugo对markdown数学公式的支持请看这里)
</p> 
      <div class="action has-text-right">
        <a href="/post/compulsory/" class="button is-primary">
                Read More
            </a>
      </div>
    </div>
  </div><div class="column is-4">
    <div class="box">
      <figure class="image is-3by2">
        <a href="/post/desheng/"><img src="/images/default_summary_huf9e8951c3521e8dfaa05ae09a282bc27_276881_600x0_resize_q75_box.jpg" alt=""></a>
      </figure>
      <h3 class="title is-5 summary-title">
        一家老北京
      </h3>
      <p class="summary-summary">今天晚上在一个多次经过店门，但没有进去过的小店吃饭。
一进店就是很热情的招待：“您几位啊”
安排入座后拿来了破烂的菜单，菜单上的菜我大多没有吃过，但是看到标题“老北京小吃”也猜测出了大概是什么。
既然是老北京小吃，那就老北京到底吧！
我点了招牌肉饼、羊杂汤（我心目中的老北京，可能因为之前不远万里绕进胡同吃过一次羊肉汤）、炸灌肠
味道其实也就比食堂好一点（严重怀疑是我点的菜不是招牌），但是这家店的氛围让人耳目一新。
店的西北角坐着三个北京爷们儿，大声嚷嚷着聊天
西南角两个老人，听口音也是纯种北京人。
刚进来的几个人（也是老北京）直接走到前台“给我约二两牛肉，还要点什么，回头问同行的人，xx毛豆，再给来点酒“（这么快就忘了具体是怎么说的了）然后掌柜的（自然而然的想起了这个词）就拿刀开始切肉。我脑中立刻联想到了孔乙己，想到了咸亨酒店（可能因为我对过去的酒店几乎没有其他印象了）想到可能很久之前的老北京们来这里吃饭喝酒，大声聊天。
吃完饭店里仅有的一位服务员和老板娘热情的说“慢点”。
对了，店里除了我没人在看手机
👇是卖肉的桌子
虽然来了饭店，但是不去研究当下的饭是如何的好吃或是难吃，而去想过去的情形，感受不同的氛围。这是一种人文的感觉吗？
👇不起眼的小店
</p> 
      <div class="action has-text-right">
        <a href="/post/desheng/" class="button is-primary">
                Read More
            </a>
      </div>
    </div>
  </div></div>
                          <div class="columns"><div class="column is-4">
    <div class="box">
      <figure class="image is-3by2">
        <a href="/post/cleveride/"><img src="/images/default_summary_huf9e8951c3521e8dfaa05ae09a282bc27_276881_600x0_resize_q75_box.jpg" alt=""></a>
      </figure>
      <h3 class="title is-5 summary-title">
        CleverIDE
      </h3>
      <p class="summary-summary"> 今天跑安卓的第一个例程：ToyVpn。这是一个很有年代感的例子，最近版本的SDK的Sample里已经没了它的踪影。因此环境的配置是一个难题，从gradle开始就出现了版本问题。
然而 这些问题都极其轻松的得到了解决，得益于十分智能的IDE——AndroidStudio
AndroidStudio不仅给出错误原因，在原因下面就给出了一键解决的办法。就像过去皇宫里侍奉的太监，只要你点点头，一切都安排好了。
虽然这对于我这样的初学者十分友善，
然而 那些吃经验的程序员，还能吃多久呢？
（怪不得很多大佬去做人工智能了，未来很多工作者真的会被机器取代）
（怪不得我院变成人工智能学院了😄）
</p> 
      <div class="action has-text-right">
        <a href="/post/cleveride/" class="button is-primary">
                Read More
            </a>
      </div>
    </div>
  </div><div class="column is-4">
    <div class="box">
      <figure class="image is-3by2">
        <a href="/post/perseverance/"><img src="/images/default_summary_huf9e8951c3521e8dfaa05ae09a282bc27_276881_600x0_resize_q75_box.jpg" alt=""></a>
      </figure>
      <h3 class="title is-5 summary-title">
        活着？
      </h3>
      <p class="summary-summary">十一放假四天了，昏昏沉沉的，什么也不想做，感觉不到还活着。
今天我才意识到事情不太对，开始在网上对照自己的“症状”判断自己得了什么病。胃？肝？心理？最终也没能“确诊”。大概根据中医模糊的理论猜测是这段时间消化能力比较弱，有点”营养不良“的意思，胃不舒服同时影响了心理和睡眠💤。
有意思的是我在”阴虚“的调养方法里看到”坚持运动“一项。确实啊，我这一个学期运动的次数屈指可数。我就是这么一个冲动的人，我立刻就穿鞋出去跑步了🏃
跑跑停停，跑到了一条没有车驶过的路上
耳机里放的是很有节奏感又不吵闹的一段人声轻吟：dililidi （3:00-），脚下的GT-2000反馈回来的软软的感觉，我终于感觉到我还活着了，我越跑越快。
</p> 
      <div class="action has-text-right">
        <a href="/post/perseverance/" class="button is-primary">
                Read More
            </a>
      </div>
    </div>
  </div><div class="column is-4">
    <div class="box">
      <figure class="image is-3by2">
        <a href="/post/vpnservice/"><img src="/images/default_summary_huf9e8951c3521e8dfaa05ae09a282bc27_276881_600x0_resize_q75_box.jpg" alt=""></a>
      </figure>
      <h3 class="title is-5 summary-title">
        VpnService使用指南
      </h3>
      <p class="summary-summary"> 什么是VPN Service VPN Service 是安卓提供给开发者的用户级的VPN服务的接口（user level interface），它将复杂的网络配置封装起来，开发者只需考虑和远端服务器的交互。总的来说，VPN Service创建了一个虚拟网卡（TUN），返回给APP一个&amp;rdquo;文件描述符&amp;rdquo;（File descriptor），对文件描述符的读写操作对应数据包的收发。VPN Service的接口工作在IP层，所操作的数据包都是符合IP数据包格式的。
具体在开发APP时，VPN的连接由两部分构成：client &amp;amp; service
客户端的VPN连接 1、调用VpnService.prepare()
初始化方法，停止其他APP创建的VPN连接，并获得使用VpnService类其他方法的权力。如果已有初始化过的VPN连接，将返回null。下面的代码将开启VPN服务绑定到点击操作上。
public void onClick(View v) { Intent intent = VpnService.prepare(getApplicationContext()); if (intent != null) { startActivityForResult(intent, 0); } else { onActivityResult(0, RESULT_OK, null); } }  初始化完成后VPN服务通过调用startService开启。需要传入一个Intent类型的参数。
 An intent is an abstract description of an operation to be performed.
 protected void onActivityResult(int requestCode, int resultCode, Intent data) { if (resultCode == RESULT_OK) { Intent intent = new Intent(this, MyVpnService.class); startService(intent); } }  2、实现VPN Service
Service类的继承有两个函数必须实现：onStartCommand &amp;amp; onDestroy
具体步骤如下：
 调用Builder得到&amp;rdquo;文件描述符&amp;rdquo;（File descriptor），需要（可以）传入ip地址、dns、路由表等参数。
 获得接口的输入输出流数据
 和VPN服务器连接
 保护VPN service，防止循环路由
 Loop main
  数据流方向如下：
Network Activity -&amp;gt; TUN -&amp;gt; in -&amp;gt; tunnel -&amp;gt; Remote Server Network Activity &amp;lt;- TUN &amp;lt;- out &amp;lt;- tunnel &amp;lt;- Remote Server  实现的代码如下：
public class MyVpnService extends VpnService { private Thread mThread; private ParcelFileDescriptor mInterface; //a. Configure a builder for the interface. Builder builder = new Builder(); // Services interface @Override public int onStartCommand(Intent intent, int flags, int startId) { // Start a new session by creating a new thread. mThread = new Thread(new Runnable() { @Override public void run() { try { //a. Configure the TUN and get the interface. mInterface = builder.setSession(&amp;quot;MyVPNService&amp;quot;) .addAddress(&amp;quot;192.168.0.1&amp;quot;, 24) .addDnsServer(&amp;quot;8.8.8.8&amp;quot;) .addRoute(&amp;quot;0.0.0.0&amp;quot;, 0).establish(); //b. Packets to be sent are queued in this input stream. FileInputStream in = new FileInputStream( mInterface.getFileDescriptor()); //b. Packets received need to be written to this output stream. FileOutputStream out = new FileOutputStream( mInterface.getFileDescriptor()); //c. The UDP channel can be used to pass/get ip package to/from server DatagramChannel tunnel = DatagramChannel.open(); // Connect to the server, localhost is used for demonstration only. tunnel.connect(new InetSocketAddress(&amp;quot;127.0.0.1&amp;quot;, 8087)); //d. Protect this socket, so package send by it will not be feedback to the vpn service. protect(tunnel.socket()); //e. Use a loop to pass packets. while (true) { //get packet with in //put packet to tunnel //get packet form tunnel //return packet with out //sleep is a must Thread.sleep(100); } } catch (Exception e) { // Catch any exception e.printStackTrace(); } finally { try { if (mInterface != null) { mInterface.close(); mInterface = null; } } catch (Exception e) { } } } }, &amp;quot;MyVpnRunnable&amp;quot;); //start the service mThread.start(); return START_STICKY; } @Override public void onDestroy() { // TODO Auto-generated method stub if (mThread != null) { mThread.interrupt(); } super.onDestroy(); }  3、权限设置
需要提供Service和Internet的权限
&amp;lt;uses-permission android:name=&amp;quot;android.permission.INTERNET&amp;quot;/&amp;gt; &amp;lt;application&amp;gt; &amp;lt;service android:name=&amp;quot;com.example.vpnsrv.MyVpnService&amp;quot; android:permission=&amp;quot;android.permission.BIND_VPN_SERVICE&amp;quot; &amp;gt; &amp;lt;intent-filter&amp;gt; &amp;lt;action android:name=&amp;quot;android.net.VpnService&amp;quot; /&amp;gt; &amp;lt;/intent-filter&amp;gt; &amp;lt;/service&amp;gt; &amp;lt;/application&amp;gt;  应用实例 使用vpn service，可以实现很多功能，如代理、数据包过滤、Bandwidth Saver(?)
一个没有代码的例子 首先看一看用vpn service实现一个数据包过滤器，需要再次提醒，vpn service的网络接口工作在OSI第三层，因此读写的都是IP数据包。
这个例子没有具体代码，思路是这样的：
 从接口（TUN）拿到IP数据包，提取网络层的信息，例如协议是TCP还是UDP，传输的数据（payload）是什么 如果是TCP，在得到传输数据（payload）前先要握手🤝，需要回传一个握手包 选择配制好的socket发出传输的数据 从socket接收数据，然后构建第三层的数据包，可以将UDP放进这个IP包内。 将IP包写入接口（TUN）  ToyVpn 这是一个有代码的例子：
ToyVpn将IP数据包嵌入到UDP数据包中，实现了一个功能简单的VPN。
虽然代码量和复杂程度较第一部分客户端的VPN连接大了不少，但最核心的连接部分是一样的。
在ToyVpnClient.java中的onCreate中完成了VPNService的初始化：
Intent intent = VpnService.prepare(ToyVpnClient.this); if (intent != null) { startActivityForResult(intent, 0); } else { onActivityResult(request:0, RESULT_OK, data:null); }  TUN的创建和文件描述符的绑定在ToyVpnConnection.java中。虽然类的构造和对异常情况的多种考虑导致代码逻辑十分复杂，但核心的几步依然没有变化。
ToyVpn工作的逻辑是客户端等待服务器发送一些参数，客户端在确认这个服务器的合法性后（handshake成功）与之建立隧道，开始有效数据的收发。
在ToyVpnConnection.java中，这种逻辑（忽略处理连接超时和异常等细节）是这样描述的：
创建builder：VpnService.Builder builder = mService.new Builder();，这里没有传入参数，因为参数是之后服务器发送过来的。接着给builder传入一些参数：
switch (fields[0].charAt(0)) { case &#39;m&#39;: builder.setMtu(Short.parseShort(fields[1])); break; case &#39;a&#39;: builder.addAddress(fields[1], Integer.parseInt(fields[2])); break; case &#39;r&#39;: builder.addRoute(fields[1], Integer.parseInt(fields[2])); break; case &#39;d&#39;: builder.addDnsServer(fields[1]); break; case &#39;s&#39;: builder.addSearchDomain(fields[1]); break;  到这里，builder就做好了。接着，接口由这句话创建：vpnInterface = builder.establish();文件描述符这样绑定到vpnInterface上，其中iface的值==vpnInterface
// Packets to be sent are queued in this input stream. FileInputStream in = new FileInputStream(iface.getFileDescriptor()); // Packets received need to be written to this output stream. FileOutputStream out = new FileOutputStream(iface.getFileDescriptor());  之后的数据传输只需要读写in、out即可，像这样：
out.write(packet.array(), 0, length); // Read the outgoing packet from the input stream. int length = in.read(packet.array());  End VPNService的基本使用方法就是这样，需要高阶玩法请参考“参考”中的网页。但在看代码的过程中发现Java的语言特性还是很复杂的，好在包看起来很好用。偶然看到一句提醒，也记在这里吧：
 keep in mind that Java treat short/long as signed values, do convert it to unsigned first.
 Long way to go.
参考： Android VPN Service Explained with Packet Bypass Example Program
VPNService
VPN
Running a service in the foreground
</p> 
      <div class="action has-text-right">
        <a href="/post/vpnservice/" class="button is-primary">
                Read More
            </a>
      </div>
    </div>
  </div></div>
                          <div class="columns"><div class="column is-4">
    <div class="box">
      <figure class="image is-3by2">
        <a href="/post/ladder/"><img src="/images/default_summary_huf9e8951c3521e8dfaa05ae09a282bc27_276881_600x0_resize_q75_box.jpg" alt=""></a>
      </figure>
      <h3 class="title is-5 summary-title">
        梯子是怎么坚挺的
      </h3>
      <p class="summary-summary"> 端口被墙？ 9/30/2019
8836端口突然上不去了，重启了几次ssserver服务：这样做的 没什么用，然后pip卸了重装，重写了配置文件，新加了8838端口，本计划用作guest端口。结果后来发现8836还是无法连通，反而8838把我带了出去。
有人说，是端口被墙了，真是神奇。
加混淆，改加密 10/3/2019
端口被封的越来越快，一个端口甚至用不了一天了。有人说可以试试加个插件，我按照他说的试了试，最终结果倒是很不错，昨天搭好的现在也没被封。配置的难度主要在客户端这里，mac之前的ss没有simple-obfs这个插件，一直连不上，最后下载github上的官方版本改了改才ok。
</p> 
      <div class="action has-text-right">
        <a href="/post/ladder/" class="button is-primary">
                Read More
            </a>
      </div>
    </div>
  </div></div>
                </div>
              </div>
            </div>
          </div>
        </div>
    </section><footer class="footer footer-dark">
  <div class="container">
    <div class="columns">
      <div class="column">
        <img src="/footer.svg" alt="">
        
      </div>
      
    <div class="column">
        <div class="footer-column">
          <div class="footer-header">
              <h3>Website</h3>
          </div>
          <ul class="link-list">
            <li>
                <a href="/credits">
                  <span class="icon"><i class="fa fa-cube"></i></span>
                  Credits
                </a>
              </li>
            <li>
              <a href="/tags">
                <span class="icon"><i class="fa fa-tag"></i></span> 
                All Tags
              </a>
            </li>
          </ul>
        </div>
      </div>
    
      <div class="column">
        <div class="footer-column">
          <div class="footer-header">
              <h3>Contacts</h3>
          </div>
          <ul class="link-list">
            <li>
              <a href="" target="_blank">
                <span class="icon"><i class="fa fa-linkedin"></i></span>
                Linkedin
              </a>
            </li>
            <li>
              <a href="mailto:cruelkiddy@qq.com" target="_blank">
                <span class="icon"><i class="fa fa-envelope"></i></span>
                cruelkiddy@qq.com
              </a>
            </li>
          </ul>
        </div>
      </div>

      <div class="column">
        <div class="footer-column">
          <div class="footer-header">
              <h3>Copyright</h3>
          </div>
          <ul class="link-list">
            <li>
              <a>
                <span class="icon"><i class="fa fa-copyright"></i></span>
                Something - 2019
              </a>
            </li>
          </ul>
        </div>
      </div>

    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
</footer>
    <div id="backtotop"><a href="#"></a></div><div class="sidebar">
  <div class="sidebar-header"><img src="/sidebar.svg" alt="">
    
    <a class="sidebar-close" href="javascript:void(0);">
      <i data-feather="x"></i>
    </a>
  </div>
  <div class="inner">
    <ul class="sidebar-menu">
      <li class="no-children">
          <a href="/tags">
            <div class="columns">
              <table width="100%">  
                <tr>
                  <td class="">
                    <span class="icon"><i class="fa fa-cubes"></i></span>All Tags
                  </td>
                  <td class="has-text-right" >
                      
                  </td>
                </tr>
              </table>
            </div>
          </a>
      <li class="no-children">
          <a href="/tags/math">
            <div class="columns">
              
              <table width="100%">  
                  <tr>
                    <td class=""><span class="icon"><i class="fa fa-cube"></i></span>Math</td>
                    <td class="has-text-right" >
                        <div class="tag-number">3</div>
                      
                    </td>
                    
                  </tr>
              </table>
              
            </div>
          </a>
      </li>
      <li class="no-children">
          <a href="/tags/sundries">
            <div class="columns">
              
              <table width="100%">  
                  <tr>
                    <td class=""><span class="icon"><i class="fa fa-cube"></i></span>Sundries</td>
                    <td class="has-text-right" >
                        <div class="tag-number">3</div>
                      
                    </td>
                    
                  </tr>
              </table>
              
            </div>
          </a>
      </li>
      <li class="no-children">
          <a href="/tags/android">
            <div class="columns">
              
              <table width="100%">  
                  <tr>
                    <td class=""><span class="icon"><i class="fa fa-cube"></i></span>Android</td>
                    <td class="has-text-right" >
                        <div class="tag-number">1</div>
                      
                    </td>
                    
                  </tr>
              </table>
              
            </div>
          </a>
      </li>
      <li class="no-children">
          <a href="/tags/eat">
            <div class="columns">
              
              <table width="100%">  
                  <tr>
                    <td class=""><span class="icon"><i class="fa fa-cube"></i></span>Eat</td>
                    <td class="has-text-right" >
                        <div class="tag-number">1</div>
                      
                    </td>
                    
                  </tr>
              </table>
              
            </div>
          </a>
      </li>
      <li class="no-children">
          <a href="/tags/ee-stuff">
            <div class="columns">
              
              <table width="100%">  
                  <tr>
                    <td class=""><span class="icon"><i class="fa fa-cube"></i></span>EE Stuff</td>
                    <td class="has-text-right" >
                        <div class="tag-number">1</div>
                      
                    </td>
                    
                  </tr>
              </table>
              
            </div>
          </a>
      </li>
      <li class="no-children">
          <a href="/tags/ladder">
            <div class="columns">
              
              <table width="100%">  
                  <tr>
                    <td class=""><span class="icon"><i class="fa fa-cube"></i></span>Ladder</td>
                    <td class="has-text-right" >
                        <div class="tag-number">1</div>
                      
                    </td>
                    
                  </tr>
              </table>
              
            </div>
          </a>
      </li></ul>
  </div>
</div>


<script src="/js/jquery-2.2.4.js"></script>
<script src="/js/feather.4.22.0.js"></script>
<script src="/js/modernizr-2.8.3.js"></script>
<script src="/js/fresh_new.js"></script>
<script src="/js/highlight.9.15.8.pack.js"></script>
<script src="/js/highlightjs-line-numbers.2.7.0.min.js"></script><script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
    document.querySelectorAll('.codeinline').forEach((block) => {
      hljs.highlightBlock(block);
    });
  });
</script></body>
</html>